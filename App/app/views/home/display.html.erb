<% content_for :page_container do %>
<!-- Page Container -->
<div class="w3-container w3-content" style="max-width:1400px;margin-top:80px">    
  <!-- The Grid -->
  <div class="w3-row">
    <!-- Left Column -->
    <div class="w3-col m3">
      <!-- Profile -->
      <div class="w3-card w3-round w3-white">
        <div class="w3-container">
         <h4 class="w3-center"><%= "#{@current_user.user_name}'s Profile"%></h4>
         <p class="w3-center"><img src=<%=@current_user.image%> class="w3-circle" style="height:106px;width:106px" alt="Avatar"></p>
         <hr>
         <p> <%= link_to("Edit User Profile", edit_user_path(@current_user), class:  'w3-bar-item w3-button w3-hide-small w3-middle w3-hover-lightgrey')%></p>
         <p> <%= button_to("Delete Account", '/users/destroy',  {method: :delete, class: 'w3-bar-item w3-button w3-hide-small w3-center w3-hover-lightgrey'})%></p>
        </div>
      </div>
      <br>
    
      <!-- Top 10 Tags --> 
      <div class="w3-card w3-round w3-white w3-hide-small">
        <div class="w3-container">
          <p>Top 10 Tags</p>
          <p>
            <% @top_ten_tags.each do |tag, color|%>
              <%= content_tag(:span, link_to(tag.name.titleize, tag_path(tag)), class: color)%>
            <%end%>
          </p>
        </div>
      </div>
      <br>
    <!-- End Left Column -->
    </div>
    
    <!-- Middle Column -->
    <div class="w3-col m7">

    
      <div class="w3-container w3-theme-d1 w3-margin">
        <h1>Home Page</h1>
      </div>
    
  

      <div class="w3-row-padding">
        <div class="w3-col m12">
          <div class="w3-card w3-round w3-white">
            <div class="w3-container w3-padding">
              <h3 class="w3-opacity">Create a New Post!</h3>
              <%= form_for(@new_post, url: posts_path) do |f|%>
                 <%= f.text_field :title, placeholder: "Your Post's Title!", class: "w3-input w3-border w3-padding"%><br /> 
                 <%= f.text_area :body, placeholder: "Your New Post!", class: "w3-input w3-border w3-padding"%><br />
                 <%= f.collection_check_boxes(:tag_ids, @tags, :id, :name) do |b|%>
                    <%=b.label(:"data-value" => b.value) { b.check_box + b.text}%>
                 <% end%> <br>
                 <h6 class="w3-opacity">Create your own tag!</h6>
                 <%= f.fields_for :tags, @new_post.tags.build do |tag| %>
                    <%= tag.text_field :name %> <br>
                    <br>
                  <%end%>
                  <%= button_tag( class: "w3-button w3-theme") do %>
                    <i class="fa fa-pencil"></i> Post
                  <% end %>
              <%end%>
            </div>
          </div>
        </div>
      </div>

      <% @posts.each do |post|%>
        <div class="w3-container w3-card w3-white w3-round w3-margin"><br>
         <%= content_tag(:h4, link_to(post.title, post_path(post)), class: "w3-left w3-circle w3-margin-right")%>
        <span class="w3-right w3-opacity"><%= "#{pluralize(post.likes.count, "Like")}"%></span> <br>
        <span class="w3-right w3-opacity"><%= time_ago_in_words(post.created_at)+ " ago"%></span>
        <hr class="w3-clear">
        <%current_conversation = @current_user.convo_exists?(post.user)%>
        <%if current_conversation%>
          <%= content_tag(:h6, link_to(post.user.user_name, conversation_messages_path(current_conversation)), class: "w3-left w3-circle w3-margin-right")%><br />
        <%else%>
          <%= content_tag(:h6, button_to(post.user.user_name, conversations_path(sender_id: @current_user.id, recipient_id: post.user.id)), class: "w3-left w3-circle w3-margin-right")%><br/>
          <br>
        <%end%>
        <br>
        <img src=<%=@current_user.image%> alt="Avatar" class="w3-left" style="width:60px">
        <%= content_tag(:p, post.summary, class: "w3-left")%>
          <div class="w3-row-padding" style="margin:0 -16px">
            <div class ="w3-row">
              Tags:
              <%post.tags.each do |tag| %>
                  <span class="w3-tag w3-small w3-theme-d1"><%=link_to(tag.name, tag_path(tag))%></span>
              <%end%> 
            </div>
          </div>
          <br>
          <div class ="w3-row">

                <% pre_like = post.likes.find { |like| like.user_id == current_user.id} %>
                <% if pre_like %>
                  <%= button_to '❌ Unlike', post_like_path(post, pre_like), method: :delete %>
                <% else %>
                  <%= button_to '❤️ Like', post_likes_path(post), { method: :post} %>
                <% end %>         
                <%= button_to(post_path(post), method: :get, class: "w3-button w3-theme-d2 w3-margin-bottom") do %>
                  <i class="fa fa-comment"></i> Leave a Comment
                <% end %>
           
        </div>
      </div>
      <%end%>
      
     
      
    <!-- End Middle Column -->
    </div>
    
    <!-- Right Column -->
    <div class="w3-col m2">
    <!-- End Right Column -->
    </div>
    
  <!-- End Grid -->
  </div>
  
<!-- End Page Container -->
</div>
<br>
<%end%>
